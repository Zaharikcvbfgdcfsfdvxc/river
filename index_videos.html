<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RiverDub — авторская озвучка и дубляж для аудитории. Релизы, демо и библиотека выпусков.">
    <meta name="keywords" content="RiverDub, озвучка, дубляж, студия озвучки, фан-даб, авторская озвучка, русский дубляж, voice over">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="RiverDub — студия озвучки">
    <meta property="og:description" content="Авторская озвучка и дубляж для аудитории. Релизы, демо и библиотека выпусков.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="img/logo.png">
    <title>RiverDub</title>
    <link rel="icon" type="image/png" href="img/logo.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header class="top-bar">
     <a href="index.html" class="logo">
        <img src="img/logo.png" alt="Логотип RiverDub">
        <span>RiverDub</span>
    </a>

    <form class="search">
        <input type="text" placeholder="Поиск видео" aria-label="Поиск">
        <button type="submit">Найти</button>
    </form>

    <nav class="nav">
        <a href="index.html">Главная</a>
        <a href="index_info.html">О нас</a>
        <a href="index_contacts.html">Контакты</a>
    </nav>
</header>

<main class="page videos-page">
    <section class="videos-hero" id="all">
        <div>
            <p class="eyebrow">Библиотека</p>
            <h1>Все работы RiverDub</h1>
            <p class="videos-lead">Подборка наших релизов озвучки и дубляжа для аудитории: видео.</p>
        </div>
    </section>

    <div class="season-filter">
        <label for="season-select">Сезон</label>
        <select id="season-select">
            <option value="">Все сезоны</option>
        </select>
    </div>

    <section class="section" id="videos">
        <div class="section-header">
            <h2>Видео</h2>
            <a href="#all">Наверх</a>
        </div>
        <div class="video-grid" id="videos-grid"></div>
        <p class="empty-state" id="videos-empty">Пока нет видео.</p>
    </section>
</main>

<footer class="footer">
    <p>(c) RiverDub Studio, 2024. <a href="index_admin.html">Все права защищены.</a></p>
</footer>
<script>
    (function () {
        const typeLabels = {
            video: 'Видео'
        };
        const formatDate = (value) => {
            if (!value) return '';
            const date = new Date(value);
            if (Number.isNaN(date.getTime())) return '';
            return date.toLocaleDateString('ru-RU');
        };
        const createCard = (item) => {
            const article = document.createElement('article');
            article.className = 'video-card';
            const link = document.createElement('a');
            link.className = 'video-link';
            link.href = `index_player.html?id=${item.id}`;
            const thumbStyle = item.preview_url
                ? `style="background-image: url('${item.preview_url}'); background-size: cover; background-position: center;"`
                : '';
            link.innerHTML = `
                <div class="thumb" ${thumbStyle}>${typeLabels[item.type] || 'Видео'}</div>
                <div class="card-body">
                    <h3>${item.title}</h3>
                    <p>${typeLabels[item.type] || 'Видео'} • ${formatDate(item.created_at)}</p>
                </div>
            `;
            article.appendChild(link);
            return article;
        };
        const fillSection = (items, gridId, emptyId) => {
            const grid = document.getElementById(gridId);
            const empty = document.getElementById(emptyId);
            grid.innerHTML = '';
            if (!items.length) {
                empty.style.display = 'block';
                return;
            }
            empty.style.display = 'none';
            items.forEach((item) => grid.appendChild(createCard(item)));
        };
        const queryParam = new URLSearchParams(window.location.search).get('q') || '';
        const searchInput = document.querySelector('.search input');
        if (searchInput && queryParam) {
            searchInput.value = queryParam;
        }
        const seasonSelect = document.getElementById('season-select');
        const seasonParam = new URLSearchParams(window.location.search).get('season') || '';
        if (seasonSelect) {
            seasonSelect.value = seasonParam;
        }
        const queryString = queryParam ? `?q=${encodeURIComponent(queryParam)}` : '';
        fetch(`/api/videos${queryString}`)
            .then((res) => res.ok ? res.json() : [])
            .then((videos) => {
                const cleaned = videos.filter((item) => item.type === 'video');
                const seasons = Array.from(
                    new Set(
                        cleaned
                            .map((item) => Number(item.season))
                            .filter((value) => Number.isFinite(value) && value > 0)
                    )
                ).sort((a, b) => a - b);

                if (seasonSelect) {
                    const current = seasonSelect.value;
                    seasonSelect.innerHTML = '<option value=\"\">Все сезоны</option>';
                    seasons.forEach((season) => {
                        const option = document.createElement('option');
                        option.value = String(season);
                        option.textContent = `Сезон ${season}`;
                        seasonSelect.appendChild(option);
                    });
                    seasonSelect.value = seasons.includes(Number(current)) ? current : '';
                }

                const applySeasonFilter = (items) => {
                    const seasonValue = seasonSelect && seasonSelect.value ? Number(seasonSelect.value) : null;
                    if (!seasonValue) return items;
                    return items.filter((item) => Number(item.season) === seasonValue);
                };

                const render = () => {
                    const filtered = applySeasonFilter(cleaned);
                    fillSection(filtered, 'videos-grid', 'videos-empty');
                };

                render();

                if (seasonSelect) {
                    seasonSelect.addEventListener('change', () => {
                        const params = new URLSearchParams(window.location.search);
                        if (seasonSelect.value) {
                            params.set('season', seasonSelect.value);
                        } else {
                            params.delete('season');
                        }
                        const query = params.toString();
                        history.replaceState(null, '', query ? `?${query}` : window.location.pathname);
                        render();
                    });
                }
            });

        })();
</script>
<script src="script.js"></script>
</body>
</html>


